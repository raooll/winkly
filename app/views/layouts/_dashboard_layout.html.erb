<% if user_signed_in? %>
  
  <nav class="bg-white shadow-sm fixed top-0 left-0 right-0 z-50 border-b border-gray-100">
    <div class="px-4 sm:px-6 lg:px-8 max-w-full mx-auto">
      <div class="flex justify-between h-16 items-center">
        
        <div class="flex items-center">
          <button id="sidebarToggle" class="lg:hidden mr-4 p-2 rounded-md text-gray-500 hover:bg-gray-100 hover:text-gray-700 transition duration-150 ease-in-out" aria-label="Toggle Menu">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          <%= link_to root_path, class: "flex-shrink-0" do %>
            <h1 class="text-3xl font-extrabold text-indigo-600 tracking-tight">Winkly</h1>
          <% end %>
        </div>
        
        <div class="flex items-center space-x-4">
          <span class="text-base font-medium text-gray-700 hidden sm:block truncate max-w-xs" title="<%= current_user.email %>">
            <%= current_user.email %>
          </span>
          <%= button_to "Sign Out", destroy_user_session_path, method: :delete, 
              class: "px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition duration-150 ease-in-out" %>
        </div>
      </div>
    </div>
  </nav>

  <aside id="sidebar" class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white shadow-2xl lg:shadow-md transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40 border-r border-gray-100">
    <div class="p-6">
      <h2 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6">Menu</h2>
      <nav class="space-y-2">
        <%# Dashboard Link %>
       
        
        <%= link_to root_path, 
            class: "flex items-center px-4 py-3 rounded-r-lg hover:bg-indigo-50/50 hover:text-indigo-700 transition duration-150 ease-in-out " do %>
          <svg class="w-5 h-5 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          Dashboard
        <% end %>
        
        <%# Short URLs Link %>
        <% urls_active = current_page?(root_path) && !current_page?(dashboard_path) ? 'text-indigo-700 bg-indigo-50 border-l-4 border-indigo-600 font-semibold' : 'text-gray-600 font-medium' %>
        
        <%= link_to short_urls_path, 
            class: "flex items-center px-4 py-3 rounded-r-lg hover:bg-indigo-50/50 hover:text-indigo-700 transition duration-150 ease-in-out" do %>
          <svg class="w-5 h-5 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
          </svg>
          Short URLs
        <% end %>
      </nav>
    </div>
  </aside>

  <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-40 z-30 hidden lg:hidden"></div>

  <main class="lg:ml-64 min-h-screen pt-16 bg-gray-50/50">
    <%= yield %>
  </main>

  <script>
    // Sidebar toggle for mobile
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');

    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', () => {
          sidebar.classList.toggle('-translate-x-full');
          sidebarOverlay.classList.toggle('hidden');
        });
    }

    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', () => {
          sidebar.classList.add('-translate-x-full');
          sidebarOverlay.classList.add('hidden');
        });
    }

    // Optional: Function for copying to clipboard (only needed on short_urls#index)
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(function() {
        // Use a less intrusive notification (like a console log or a toast/modal if available) 
        // but keeping the simple alert for this refactor.
        alert('Link copied to clipboard!'); 
      }, function(err) {
        console.error('Could not copy text: ', err);
      });
    }
  </script>
<% else %>
  
<div class="flex items-center justify-center h-screen">
  <div class="bg-linear-to-br from-indigo-50 to-purple-50 flex items-center justify-center px-4 py-16 w-full">
    <div class="max-w-5xl mx-auto text-center">
      
      <h1 class="text-5xl font-black text-indigo-700 mb-8 tracking-tighter">Winkly</h1>

      <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-6 leading-tight">
        Shorten Your Links, <span class="text-indigo-600">Amplify Your Campaigns</span>
      </h2>
      
      <p class="text-xl md:text-xxl text-gray-600 mb-10 max-w-3xl mx-auto">
        Create dynamic short links that alternate between two destinations. Perfect for seamless A/B testing, campaign rotation, and maximizing click potential.
      </p>
      
      <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6">
        <%= link_to "Get Started â€” It's Free", new_user_registration_path, 
            class: "px-10 py-4 text-xl font-bold text-white bg-indigo-600 rounded-xl hover:bg-indigo-700 shadow-2xl hover:shadow-indigo-500/50 transition duration-200 ease-in-out transform hover:-translate-y-0.5" %>
        <%= link_to "Sign In", new_user_session_path, 
            class: "px-10 py-4 text-xl font-bold text-indigo-600 bg-white rounded-xl hover:bg-gray-100 shadow-xl border border-gray-200 transition duration-200 ease-in-out" %>
      </div>
    </div>
  </div>
</div>
<% end %>